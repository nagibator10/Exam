window.jQuery&&window.jQuery.fn.bem&&window.bemhtml&&(BEM.DOM.decl({name:"input",modName:"voice-search",modVal:"check"},{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._checkMicSupport()}}},_enableVoiceRecognition:function(){this._onSuccessLoad()},_onSuccessLoad:function(){this.setMod("voice-search","yes"),this._initVoiceSearch(),this._triggerResize()}}),BEM.DOM.decl({name:"input",modName:"voice-search",modVal:"check"},{_checkMicSupport:function(){BEM.blocks["i-voice"].hasMicSupport(function(e){if(!e){var t,i=this.findBlockOutside("search2");i&&(t=Number(i.getMod("buttons-outside")),i.setMod("buttons-outside",t?t+1:1)),this._enableVoiceRecognition()}}.bind(this))}}),BEM.decl("i-voice",{},{hasMicSupport:function(e){var t;navigator.enumerateDevices?t=navigator.enumerateDevices.bind(navigator):(window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(t=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(t=function(e){navigator.mediaDevices.enumerateDevices().then(e)})),t?t(function(t){var i=t.some(function(e){return"audio"===e.kind||"audioinput"===e.kind});e(!i&&{message:"Mic is not available"})}):e({message:"API is Not supported"})}}),BEM.DOM.decl({name:"input",modName:"voice-search",modVal:"yes"},{_popupInited:!1,_voiceSearchPopup:null,_search2Form:null,_micEvent:function(){return"click"},_popupOnLoadKey:"show-voice-input",_popupEventListeners:null,destruct:function(){if(this.elem("voice-search").off(this._micEvent()),this._location.un("change",this._onLocationChange),this._popupEventListeners)for(var e in this._popupEventListeners)Object.prototype.hasOwnProperty.call(this._popupEventListeners,e)&&this._voiceSearchPopup.un(e,this._popupEventListeners[e]);this.__base.apply(this,arguments)},_initVoiceSearch:function(){this._onLocationChange=this._onLocationChange.bind(this),this._search2Form=this.findBlockOutside("search2"),this._location=BEM.blocks.location.getInstance(),this._bindClickEvent()},_bindClickEvent:function(){this.elem("voice-search").on(this._micEvent(),this._onVoiceIconClick.bind(this))},_onVoiceIconClick:function(e){this._counterHandler("iconClick"),this.recognitionInit(e),e.preventDefault()},_onLocationChange:function(){this._hidePopup(this._voiceSearchPopup.stopTypes.LOCATION_CHANGE)},_initEvents:function(){var e=this,t=e._voiceSearchPopup.events;for(var i in this._location.on("change",this._onLocationChange),this._popupEventListeners={},this._popupEventListeners[t.START]=function(){e._setVoiceSearchState(!0)},this._popupEventListeners[t.HIDE]=function(){e._setVoiceSearchState(!1)},this._popupEventListeners[t.SUCCESS]=function(t,i){var n=i.session.recognizedText;e.val(n,{suggest:!1});var s=Ya.SUGGEST&&Ya.SUGGEST.main;s&&(s._control&&s._input?(s._control.value=s._input.value=n,s._syncVal()):e.updateData&&e.updateData(n))},this._popupEventListeners[t.AFTER_SUCCESS]=function(){e._setVoiceSearchState(!1),e._submitForm()},this._popupEventListeners[t.COUNTER]=function(t,i){e._counterHandler(i.type,i.vars)},this._popupEventListeners)Object.prototype.hasOwnProperty.call(this._popupEventListeners,i)&&this._voiceSearchPopup.on(i,this._popupEventListeners[i])},_setVoiceSearchState:function(e){var t=this.elem("voice-search");e?(this.setMod("focused",""),this.setMod(t,"active","yes"),this.bindTo("control","input.recognize",function(){this._hidePopup(this._voiceSearchPopup.stopTypes.INPUT)})):(this.unbindFrom("control","input.recognize"),this.delMod(t,"active"))},_startRecognize:function(){this._voiceSearchPopup.startRecognition({lang:BEM.blocks["i-global"].param("lang"),apikey:"f2469bd8-50d8-4ed8-a773-865a81eb9352",recognitionModel:this.params.recognitionModel||"general",utteranceSilence:this.params.utteranceSilence||100,use_snr:this.params.useSnr,yandexuid:BEM.blocks["i-global"].param("yandexuid"),applicationName:this._applicationName})},_hidePopup:function(e){this._voiceSearchPopup.hide(e)},_submitForm:function(){this._search2Form.domElem.trigger("submit",{item:this,notSendCounter:!0,cgiQuerySource:"voice"})},_counterHandler:function(e,t){var i=[];for(var n in t=t||{})t.hasOwnProperty(n)&&i.push("-"+n+"="+t[n]);i.push("action=dynamic_click"),window.Ya.counter.w(null,this.params.counterMicrophone[e][0],i.join(","))},_initPopup:function(){this._popupInited||(BEM.blocks["voice-search-popup"].init({showMicHelper:this.params.showMicHelper}),this._voiceSearchPopup=this.findBlockOutside("b-page").findBlockInside("voice-search-popup"),this._initEvents(),this._popupInited=!0)},recognitionInit:function(e){e&&e.stopPropagation(),this._initPopup(),!this._voiceSearchPopup._startedRecognize&&this._startRecognize()},_triggerResize:function(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}}),BEM.DOM.decl({name:"input",modName:"voice-search",modVal:"yes"},{_applicationName:"serpdesktop"}),BEM.DOM.decl({name:"input",modName:"voice-search",modVal:"yes"},{_applicationName:"imgdesktop"}),BEM.DOM.decl("voice-search-popup",{_prevState:null,_contentInited:{},_visibilityEventName:function(){var e;return["hidden","mozHidden","webkitHidden","msHidden"].forEach(function(t){!e&&t in document&&(e=t)}),e&&e.replace(/hidden/i,"visibilitychange")}(),onSetMod:{js:{inited:function(){this._setupProperties(),this._bindEvents(),this._setupIndicator()}},"speechkit-state":function(e,t){this._leaveMod&&this._leaveMod(),this.afterCurrentEvent(function(){if(this.hasMod(e,t)){var i=!this._contentInited[t]&&this._content&&this._content();i&&(this.elem("content").append(BEMHTML.apply($.extend({block:"voice-search-popup"},i))),this._contentInited[t]=!0),this._initMod&&this._initMod()}})}},events:{SHOW:"show",HIDE:"hide",START:"start",INIT:"voice-search-init",TEXT:"text",SUCCESS:"success",AFTER_SUCCESS:"after-success",STOP:"stop",ERROR:"error",COUNTER:"counter"},stopTypes:{PAGE_INVISIBLE:"page-invisible",LOCATION_CHANGE:"location-change",PARANJA_CLICK:"paranja-click",SCROLL_PAGE:"scroll-page",BTN_CONTINUE:"btn-continue",BTN_HELP:"btn-help",CROSS_CLOSE:"cross-close",INPUT:"input",ESC_KEY:"esc-key",HISTORY_CHANGE:"history-change"},TIMEOUT_SUCCESS_RECOGNITION:700,state:{name:"state",opened:"opened",closed:"closed"},speechKitState:{name:"speechkit-state",init:"init",start:"start",recognized:"recognized",finish:"finish",error:"error",access:"access"},audioState:{name:"audio-state",idle:"idle",busy:"busy",onset:"onset"},startRecognition:function(e){this._subscribingVoiceRecognition(!0),this._recognitionOptions=this._getRecognitionOptions(e),this.voiceRecognition.startRecognize(this._recognitionOptions)},stopRecognition:function(e){this.voiceRecognition.stopRecognize(e)},hide:function(e){this.hasMod(this.speechKitState.name,this.speechKitState.access)||(this.voiceRecognition.stopRecognize(e),this._hide(e))},_show:function(){this.hasMod(this.state.name,this.state.opened)||(this._showParanja(),!this._startedRecognize&&this._bindGlobalEvents(),this.setMod(this.state.name,this.state.opened),this.trigger("show"),this._location&&this._location.change({url:window.location.href,history:!0,trigger:!1,voiceSearch:"shown"}))},_hide:function(e){this.hasMod(this.state.name,this.state.opened)&&(this.setMod(this.state.name,this.state.closed),this._setState(""),this.trigger("hide",e),this._subscribingVoiceRecognition(!1),this._unbindGlobalEvents(),this._hideParanja(),this._location&&"shown"===this._location.getState().voiceSearch&&window.history&&window.history.back())},_getRecognitionOptions:function(e){return e},_setupProperties:function(){this.voiceRecognition=BEM.blocks["i-voice"];var e={},t=this.voiceRecognition.events;this.__base.apply(this,arguments),this.voiceEventsType=this.voiceRecognition.eventsType,e[t.BEFORE_START_RECOGNIZE]=this._voiceBeforeStart.bind(this),e[t.START_RECOGNIZE]=this._voiceStart.bind(this),e[t.PERMISSION_REQUEST]=this._voicePermissionRequest.bind(this),e[t.SPEECH_KIT_ACCESS_GRANTED]=this._voiceAccessGranted.bind(this),e[t.SPEECH_KIT_INIT]=this._voiceSpeechKitInit.bind(this),e[t.RECOGNIZE_TEXT]=this._voiceRecognizeText.bind(this),e[t.STOP_RECOGNIZE]=this._voiceStopRecognize.bind(this),e[t.ERROR]=this._voiceOnError.bind(this),this._onVoiceRecognitionBinded=e,this._location=BEM.blocks.location.getInstance()},_voiceBeforeStart:function(e,t){this._startedRecognize||(this._session=t.session,this._lastError="",this._showParanja(),this._loadingTimeout=setTimeout(function(){this._startedRecognize&&(this._setState("init"),this._show())}.bind(this),1e3),this.trigger(this.events.START))},_voiceStart:function(){clearTimeout(this._loadingTimeout),this._unbindGlobalEvents()},_voicePermissionRequest:function(){this._setState("access")},_voiceAccessGranted:function(){this._show(),this._setState("init"),this._startedRecognize=!0},_voiceSpeechKitInit:function(e,t){this.trigger(this.events.INIT,t),this._setState("start")},_voiceRecognizeText:function(e,t){this._session.recognizedText&&(this.trigger(this.events.TEXT,t),this._setState("recognized"))},_voiceStopRecognize:function(e,t){this._startedRecognize=!1,this._voiceStopHandler(t),this.trigger(this.events.STOP,t)},_voiceStopHandler:function(e){if(e.type===this.voiceEventsType.SUCCESS_RECOGNIZE||e.type===this.voiceEventsType.TIMEOUT_SUCCESS)return this._setState("finish"),this.trigger(this.events.SUCCESS,e),void setTimeout(function(){this.trigger(this.events.AFTER_SUCCESS,e),this._hide(e.type)}.bind(this),this.TIMEOUT_SUCCESS_RECOGNITION);e.type!==this.voiceEventsType.ERROR_INIT&&e.type!==this.voiceEventsType.ERROR_SPEECH_KIT&&this._hide(e.type)},_voiceOnError:function(e,t){this.trigger(this.events.ERROR,t),this._lastError=t.message,this._setState("error"),this._startedRecognize=!1},_subscribingVoiceRecognition:function(e){for(var t in this._onVoiceRecognitionBinded)this._onVoiceRecognitionBinded.hasOwnProperty(t)&&this.voiceRecognition[e?"on":"un"](t,this._onVoiceRecognitionBinded[t])},_bindEvents:function(){this.bindTo("cross","click",function(){this.hide(this.stopTypes.CROSS_CLOSE)},this)},_bindGlobalEvents:function(){var e=this;this._visibilityEventName&&$(document).one(this._visibilityEventName+".voice-search-popup",function(){e.afterCurrentEvent(function(){e.hide(e.stopTypes.PAGE_INVISIBLE)})}),$(window).one("scroll.voice-search-popup",function(){e.hide(e.stopTypes.SCROLL_PAGE)}),BEM.DOM.win.on("popstate.voice-search-popup",function(){e.hide(e.stopTypes.HISTORY_CHANGE)}),this._bindParanjaClick()},_unbindGlobalEvents:function(){$(window).off("scroll.voice-search-popup"),this._visibilityEventName&&$(document).off(this._visibilityEventName+".voice-search-popup"),BEM.DOM.win.off("popstate.voice-search-popup"),this._unbindParanjaClick()},_setState:function(e){this.setMod(this.speechKitState.name,e?this.speechKitState[e]:"")},_initParanja:function(){if(this._paranja)$.contains(BEM.DOM.scope[0],this._paranja.domElem[0])||this._paranja.domElem.appendTo(BEM.DOM.scope);else{var e=$(BEMHTML.apply({block:"paranja",mods:{theme:"normal",state:"close"},mix:{block:"voice-search-popup",elem:"paranja"}}));BEM.DOM.append(BEM.DOM.scope,e),BEM.DOM.init(e),this._paranja=this.findBlockOn(e,"paranja")}},_showParanja:function(){this._initParanja(),this._paranja.open()},_hideParanja:function(){this._paranja.hasMod("state","close")||(this._paranja.domElem.one("transitionend",function(){$(this).detach()}),this._paranja.close())},_bindParanjaClick:function(){var e=this;setTimeout(function(){e._paranja.on("click",function(){e.hide(e.stopTypes.PARANJA_CLICK),e._paranja.un("click")})},500)},_unbindParanjaClick:function(){this._paranja.un("click")}},{_inited:!1,_buildContent:function(){return[{elem:"indicator"},{elem:"cross"},{elem:"content",content:this._buildText()}]},_buildPopup:function(e){var t=[{block:"voice-search-popup",js:e||!0,mods:{state:"closed",counter:"yes",indicator:"yes","show-mic-helper":e.showMicHelper?"yes":""},content:this._buildContent(e)}];return $(BEMHTML.apply(t))},init:function(e){if(!this._inited){var t=this._buildPopup(e);BEM.DOM.append(BEM.DOM.scope,t),BEM.DOM.init(t),this._inited=!0}}}),BEM.DOM.decl("voice-search-popup",{},{_buildText:function(){return{elem:"text",content:{elem:"title"}}}}),BEM.DOM.decl("voice-search-popup",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._hideByEsc=this.hide.bind(this,this.stopTypes.ESC_KEY),this._hideByBackspace=this.hide.bind(this,this.stopTypes.INPUT)}}},_bindGlobalEvents:function(){BEM.blocks["i-keyrouter"].on({esc:this._hideByEsc,backspace:this._hideByBackspace}),this.__base.apply(this,arguments)},_unbindGlobalEvents:function(){BEM.blocks["i-keyrouter"].un({esc:this._hideByEsc,backspace:this._hideByBackspace}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"voice-search-popup",modName:"counter",modVal:"yes"},{_sessionId:0,counters:{START:"start",INIT:"init",FIRST:"first",STOP:"stop",DATA:"data",ERROR:"error",HIDE:"hide"},onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._bindCounterEvents()}}},_bindCounterEvents:function(){var e,t,i,n=this,s=this.events;this.on(s.START,function(){e=Date.now(),t=!1,i=!1,n._sessionId=0}).on(s.INIT,function(i,s){n._sessionId=s.session.id,n._triggerCounter(n.counters.START,{timestamp:e}),t=!0,n._triggerCounter(n.counters.INIT)}).on(s.TEXT,function(){i||(n._triggerCounter(n.counters.FIRST),i=!0)}).on(s.STOP,function(e,t){n._triggerCounter(n.counters.STOP,{eventType:t.type})}).on(s.SUCCESS,function(e,t){n._triggerCounter(n.counters.DATA,{eventType:t.type})}).on(s.ERROR,function(i,s){t||n._triggerCounter(n.counters.START,{timestamp:e}),n._triggerCounter("error",{message:encodeURIComponent(s.message)})}).on(s.HIDE,function(e,t){n._triggerCounter(n.counters.HIDE,{eventType:t})})},_triggerCounter:function(e,t){(t=t||{}).timestamp=t.timestamp||Date.now(),t.sessionId=this._sessionId,this.trigger(this.events.COUNTER,{type:e,vars:t})}}),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"start"},{_content:function(){return{elem:"start",content:{elem:"title",content:"Говорите...".split("").map(function(e){return{tag:"span",content:e}})}}}}),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"init"},{_content:function(){return{elem:"init",content:{elem:"title",content:"Секунду"}}}}),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"error"},{_initMod:function(){var e=this,t=this._getErrorText(this._lastError);this._show(),this.findElem("error","title").text(t.title),this.findElem("error","subtitle").html(t.subtitle),this.bindTo("continue-button","click",function(){e.hide(e.stopTypes.BTN_CONTINUE)}),this.bindTo("help-button","click",function(){e.hide(e.stopTypes.BTN_HELP)})},_leaveMod:function(){this.unbindFrom("continue-button","click"),this.unbindFrom("help-button","click")},_getErrorText:function(e){return e=this._parseError(e),this.errorDescription[e]},_parseError:function(e){return-1!==(e=String(e)).indexOf("Socket error:")||"offline"===e?"ConnectionProblemError":"Permission denied"===e||"MediaDeviceFailedDueToShutdown"===e||"PermissionDeniedError"===e?"PermissionDeniedError":-1!==e.indexOf("not allowed")||"PermissionDismissedError"===e||"Permission dismissed"===e?"PermissionDeniedError":"other"},_content:function(){return{elem:"error",content:[{elem:"title"},{elem:"subtitle"},{elem:"actions",content:[this._buildContinueBtn(),this._buildHelpButton&&this._buildHelpButton()]}]}}}),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"error"},{errorDescription:{PermissionDeniedError:{title:"Вы заблокировали доступ к микрофону",subtitle:"Как включить голосовой поиск, можно узнать в помощи"},PermissionDismissedError:{title:"Вы заблокировали доступ к микрофону",subtitle:"Как включить голосовой поиск, можно узнать в помощи"},ConnectionProblem:{title:"Проверьте соединение с интернетом",subtitle:"Ошибка соединения"},other:{title:"Неизвестная ошибка"}},_buildContinueBtn:function(){return{block:"button2",mods:{theme:"action",size:"m"},mix:{block:"voice-search-popup",elem:"continue-button"},content:{elem:"text",content:"Продолжить поиск"}}}}),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"error"},{_initMod:function(){this.__base.apply(this,arguments),this.setMod("mic-arrow",this._needShowHelper(this._lastError)?"yes":"no")},_needShowHelper:function(e){return this.params.showMicHelper&&("PermissionDeniedError"===e||"PermissionDismissedError"===e)},_getErrorText:function(e){var t=this.__base.apply(this,arguments);return this._needShowHelper(e)&&(t.subtitle=BEMHTML.apply(["Чтобы разблокировать микрофон, нажмите на иконку ",{block:"voice-search-popup",elem:"error-access-icon"},"в строке браузера"])),t},_buildHelpButton:function(){return{block:"button2",mods:{theme:"pseudo",size:"m",type:"link"},mix:{block:"voice-search-popup",elem:"help-button"},url:"https://yandex.ru/support/search/how-to-search/voice-search.html",target:"_blank",content:{elem:"text",content:"Как настроить микрофон"}}}}),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"recognized"},{_initMod:function(){this._setRecognizedText()},_setRecognizedText:function(){this._session.recognizedText&&this.elem("text").text(this._session.recognizedText)},_voiceRecognizeText:function(){this.__base.apply(this,arguments),this._setRecognizedText()}}),BEM.DOM.decl({block:"voice-search-popup",modName:"indicator",modVal:"yes"},{_indicatorHeightMultiplier:.8,_lastAmplitute:0,SMOOTH_CONSTANT:.8,_setupProperties:function(){this.__base.apply(this,arguments),this._indicator=this.elem("indicator"),this._setupIndicatorBinded=this._setupIndicator.bind(this),this._calcSoundAmplitudePerFrameBinded=this._calcSoundAmplitudePerFrame.bind(this)},_voiceSpeechKitInit:function(e,t){this.__base.apply(this,arguments);var i=t.session.streamer.recorder.getAnalyserNode();i.fftSize=32,i.smoothingTimeConstant=.95,this._analyserNode=i,this._calcSoundAmplitudePerFrame()},_bindGlobalEvents:function(){this.__base.apply(this,arguments),$(window).on("resize.voice-search-popup_indicator",this._setupIndicatorBinded)},_unbindGlobalEvents:function(){this.__base.apply(this,arguments),$(window).off("resize.voice-search-popup_indicator")},_setupIndicator:function(){var e=this.elem("content").height()*this._indicatorHeightMultiplier;e=Math.floor(e),this._indicator.width(e),this._indicator.height(e)},_getProcessedAmplitude:function(e,t){return this.SMOOTH_CONSTANT*e+(1-this.SMOOTH_CONSTANT)*t},_updateIndicatorByAmplitude:function(e){var t=e<=this._lastAmplitute;if(e=this._getProcessedAmplitude(e,this._lastAmplitute),this._lastAmplitute=e,e<=.4||t&&this.getMod(this.audioState.name)!==this.audioState.idle)return this._indicator.css("transform",""),this._indicator.css("transition",""),void this._indicator.css("opacity","");var i=Math.min(1.2*e,1);this._indicator.css("transition","opacity .1s linear, transform 0s linear"),this._indicator.css("transform","translate(-50%, -50%) scale("+i+")"),this._indicator.css("opacity","1")},_onSoundChangeAmplitude:function(e){this.getMod(this.speechKitState.name)!==this.speechKitState.finish&&this._updateIndicatorByAmplitude(e)},_calcSoundAmplitudePerFrame:function(){if(this._analyserNode&&this._startedRecognize){var e=new Uint8Array(this._analyserNode.frequencyBinCount);this._analyserNode.getByteFrequencyData(e);var t=Array.prototype.slice.call(e,0,4),i=t.reduce(function(e,t){return e+t},0)/t.length/255;this._onSoundChangeAmplitude(i),window.requestAnimationFrame(this._calcSoundAmplitudePerFrameBinded)}}}),function(){var e,t,i={};BEM.decl("i-voice",{},{events:{ERROR:"error",BEFORE_START_RECOGNIZE:"before-start-recognize",START_RECOGNIZE:"start-recognize",SPEECH_KIT_INIT:"speech-kit-init",SPEECH_KIT_ACCESS_GRANTED:"speech-kit-access-granted",RECOGNIZE_TEXT:"recognize-text",STOP_RECOGNIZE:"stop-recognize",PERMISSION_REQUEST:"permission-request"},eventsType:{ERROR_INIT:"error-init",ERROR_SPEECH_KIT:"error-speech-kit",SUCCESS_RECOGNIZE:"success-recognize",TIMEOUT_SUCCESS:"timeout-success",TIMEOUT_EMPTY:"timeout-empty"},TIMEOUT_RECOGNIZE:1e4,startRecognize:function(e){i={recognizedText:"",_startedRecognize:!0,maxTime:e.maxTime||0===e.maxTime?e.maxTime:this.TIMEOUT_RECOGNIZE},this.trigger(this.events.BEFORE_START_RECOGNIZE,{session:i}),this._getStreamer(function(n){if(!n.err&&n.streamer){var s=e.codec||window.ya.speechkit.FORMAT.OPUS||window.ya.speechkit.FORMAT.PCM16;i.streamer=n.streamer,i.streamer.start({lang:e.lang,model:e.recognitionModel,apikey:e.apikey,initCallback:this._speechKitInitHandler.bind(this),accessGrantedCallback:this._speechKitAccessGrantedHandler.bind(this),dataCallback:this._speechKitDataHandler.bind(this),errorCallback:this._speechKitErrorHandler.bind(this),format:s,particialResults:!0,utteranceSilence:Math.max(e.utteranceSilence||0,60),use_snr:Boolean(e.use_snr),yandexuid:e.yandexuid,applicationName:e.applicationName}),this.trigger(this.events.START_RECOGNIZE,{session:i}),t=setTimeout(function(){this.isStartedRecognize()&&!this.isPermissionProvided()&&this.trigger(this.events.PERMISSION_REQUEST,{session:i})}.bind(this),500)}else this.trigger(this.events.ERROR,{type:this.eventsType.ERROR_INIT,message:n.err})}.bind(this))},isStartedRecognize:function(){return i._startedRecognize},stopRecognize:function(e,n){this.isStartedRecognize()&&(clearTimeout(t),this._resetTimeout(),i._startedRecognize=!1,i.streamer&&i.streamer.abort(),this.trigger(this.events.STOP_RECOGNIZE,{type:e,session:i,data:n}))},isSpeechkitLoaded:function(){return window.ya&&window.ya.speechkit&&window.ya.speechkit.SpeechRecognition},isPermissionProvided:function(){return window.ya.speechkit.isPermissionProvided()},_speechKitDataHandler:function(e,t){e&&(i.recognizedText=e,this.afterCurrentEvent(function(){this.trigger(this.events.RECOGNIZE_TEXT,{session:i,isDone:t})}.bind(this))),t&&this.stopRecognize(this.eventsType.SUCCESS_RECOGNIZE)},_speechKitInitHandler:function(e){i.id=e,this.trigger(this.events.SPEECH_KIT_INIT,{session:i})},_speechKitAccessGrantedHandler:function(){this._resetTimeout(),this._startTimeout(),this.trigger(this.events.SPEECH_KIT_ACCESS_GRANTED,{session:i})},_speechKitErrorHandler:function(e){i._startedRecognize=!1,clearTimeout(t),this.trigger(this.events.ERROR,{type:this.eventsType.ERROR_SPEECH_KIT,session:i,message:e})},_startTimeout:function(){i.maxTime&&(i._timerRecognize=setTimeout(this._timeoutHandler.bind(this),i.maxTime))},_resetTimeout:function(){i._timerRecognize&&(clearTimeout(i._timerRecognize),i._timerRecognize=null)},_timeoutHandler:function(){i._timerRecognize=null;var e=Boolean(i.recognizedText);this.stopRecognize(this.eventsType[e?"TIMEOUT_SUCCESS":"TIMEOUT_EMPTY"])},_loadSpeechkit:function(e){var t=document.createElement("script");t.async="async",t.src="//yastatic.net/webspeechkit/webspeechkit-recognition.min.js",window.Ya.disableCrossOrigin||(t.crossOrigin=""),t.onload=function(){e(!0)},t.onerror=function(){e(!1)},document.body.appendChild(t)},_initStreamer:function(t){try{t({streamer:e=new window.ya.speechkit.SpeechRecognition})}catch(e){t({err:"Error at SpeechStreamer create"})}},_getStreamer:function(t){var i=this;e?t({streamer:e}):this.isSpeechkitLoaded()?this._initStreamer(t):this._loadSpeechkit(function(e){e?i.afterCurrentEvent(function(){i._initStreamer(t)}):t({err:"Error when loading webspeechkit"})})}}),void 0===window.ya&&(window.ya={}),void 0===window.ya.speechkit&&(window.ya.speechkit={});var n={websocketProtocol:"wss://",asrUrl:"webasr.yandex.net/asrsocket.ws",ttsUrl:"https://tts.voicetech.yandex.net",ttsStreamUrl:"webasr.yandex.net/ttssocket.ws",lang:"ru-RU",langWhitelist:["ru-RU","tr-TR","en-US","en-GB","uk-UA","ru","tr","en","uk","en-EN"],model:"notes",applicationName:"jsapi",apikey:"",uuid:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})};void 0===window.ya.speechkit._extend?window.ya.speechkit.settings=n:window.ya.speechkit.settings=window.ya.speechkit._extend(n,window.ya.speechkit.settings)}(),BEM.DOM.decl({block:"voice-search-popup",modName:"speechkit-state",modVal:"access"},{_content:function(){return this.params.showMicHelper&&{elem:"access",content:[{elem:"title",content:"Разрешите доступ к микрофону"},{elem:"subtitle",content:"Голосовой поиск позволяет задавать запросы голосом, для этого необходим доступ к вашему микрофону"}]}}}),BEMHTML.compile(function(){block("button2")(def()(function(){return void 0===this.mods.view&&(this.mods.view="classic"),this.mods.progress&&(this.mods.disabled="yes"),void 0===this.ctx.tabindex&&(this.ctx.tabindex="0"),applyNext()}),match(function(){return void 0===this.ctx.tag}).tag()("button"),("undefined"!=typeof addJs?addJs:js)()(function(){return{_tabindex:this.mods.disabled?this.ctx.tabindex:void 0}}),attrs()(function(){var e=this.ctx,t=Boolean(this.mods.disabled);return this.extend({type:"button",autocomplete:"off",id:e.id,title:e.title,name:e.name,value:e.val,tabindex:t?void 0:e.tabindex,disabled:t,"aria-disabled":t&&"true"},applyNext())}),match(function(){return!this.ctx.content}).content()(function(){var e=this.ctx;return[e.icon&&{elem:"icon",icon:e.icon},e.iconLeft&&{elem:"icon",elemMods:{side:"left"},icon:e.iconLeft},e.iconRight&&{elem:"icon",elemMods:{side:"right"},icon:e.iconRight},void 0!==e.text&&(this.isSimple(e.text)?{elem:"text",content:{html:this.xmlEscape(e.text)}}:this.extend(e.text,{elem:"text"}))].filter(Boolean)})),block("button2")(attrs()(function(){var e=applyNext()||{};return e["data-counter"]=this.ctx["data-counter"],e})),block("button2").elem("text").tag()("span"),block("button2").mod("type","link")(def()(function(){var e=this.ctx.url;return this._url=this.isSimple(e)?e:this.reapply(e),void 0===this.ctx.tabindex&&(this.ctx.tabindex="0"),applyNext()}),tag()("a"),match(function(){return"_blank"===this.ctx.target}).attrs()(function(){var e=this.ctx.attrs,t=void 0!==Object(e).rel?String(e.rel):"";return t&&-1===t.indexOf("noopener")&&(e.rel=t+" noopener"),this.extend({rel:"noopener"},applyNext())}),attrs()(function(){var e=void 0!==this._url,t=Boolean(this.mods.disabled)?e&&-1:this.ctx.tabindex;return this.extend(applyNext(),{target:this.ctx.target,href:this.mods.disabled?void 0:this.ctx.url,autocomplete:void 0,type:void 0,disabled:void 0,tabindex:t})}),js()(function(){return this.extend(applyNext(),{_url:this.mods.disabled?this.ctx.url:void 0})}))}));